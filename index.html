<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="src/css/style.css">
    <title>MyTaskToday</title>
</head>

<body class="bg-gray-700">
    <script src="https://unpkg.com/vue@3"></script>
    <div id="app">
        <div class="m-auto max-w-xl p-2">
            <div class="my-2 flex gap-2">
                <div class="flex-grow">
                    <input v-model="inputValue" type="text" placeholder="Item description"
                        class="w-full rounded-xl px-4 py-2 text-base shadow-sm outline-none hover:shadow-md focus:shadow-md" />
                </div>
                <button @click="addNewItem"
                    class="rounded-xl bg-black px-4 text-white shadow-sm hover:shadow-md active:shadow-none">Add</button>
            </div>
            <div class="mb-1 text-white" v-for="(day, _index) in reverseDays">
                <span class="text-2xl" v-html="day.title">title_example</span>
                <div class="mb-1 flex items-baseline gap-2" v-for="(item, index) in day.items">
                    <input @blur="saveCurrentDays" v-model="item.checked" type="checkbox" name="item"
                        :id="'item-'+_index+'-'+index" :checked="item.checked" />
                    <label v-bind:class="{ 'line-through': item.checked }" :for="'item-'+_index+'-'+index"
                        v-html="item.description"
                        class="hover:md:text-blue-200 active:md:text-white">item_description</label>
                </div>
                <hr class="border-t-2 border-t-black" />
            </div>
        </div>
    </div>
    </div>

    <script>
        const { createApp } = Vue

        const appConfig = {
            data() {
                return {
                    inputValue: "",
                    days: [{ "title": "8/7/2022", "items": [{ "description": "subir meu app no github pages", "complete": false, "checked": true }, { "description": "mostrar pros caras", "complete": false, "checked": true }, { "description": "ouvir uma música", "complete": false, "checked": true }, { "description": "assistir video sobre redes do Akita", "complete": false, "checked": true }] }, { "title": "9/7/2022", "items": [{ "description": "assistir um vídeo do desenvolvedor.io", "complete": false, "checked": true }] }, { "title": "30/7/2022", "items": [{ "description": "libs monogame: https://github.com/aloisdeniel/awesome-monogame", "complete": false, "checked": true }, { "description": " MonoGame Tutorial 001 - Drawing a Sprite ", "complete": false, "checked": true }, { "description": "http://rbwhitaker.wikidot.com/monogame-getting-started-tutorials", "complete": false, "checked": true }, { "description": "http://rbwhitaker.wikidot.com/introduction-to-monogame", "complete": false, "checked": true }, { "description": "http://rbwhitaker.wikidot.com/setting-up-monogame", "complete": false, "checked": true }, { "description": "http://rbwhitaker.wikidot.com/monogame-project-template", "complete": false, "checked": true }, { "description": "http://rbwhitaker.wikidot.com/monogame-managing-content", "complete": false, "checked": true }, { "description": "http://rbwhitaker.wikidot.com/monogame-2d-tutorials", "complete": false }, { "description": "http://rbwhitaker.wikidot.com/monogame-introduction-to-2d-graphics", "complete": false, "checked": true }, { "description": "http://rbwhitaker.wikidot.com/monogame-spritebatch-basics", "complete": false }] }]
                }
            },
            mounted() {
                try {
                    const currentLocalContent = JSON.parse(localStorage.days)

                    if (!Array.isArray(currentLocalContent)) {
                        localStorage.days = JSON.stringify([])
                    }
                } catch (e) {
                    localStorage.days = JSON.stringify([])
                }

                this.days = JSON.parse(localStorage.days)
            },
            computed: {
                reverseDays() {
                    return this.days
                        .sort((a, b) => Date.parse(b.title.replace(/(\d+)\/(\d+)\/(\d+)/, '$2/$1/$3')) - Date.parse(a.title.replace(/(\d+)\/(\d+)\/(\d+)/, '$2/$1/$3')))
                }
            },
            methods: {
                addNewItem() {
                    const today = new Date(Date.now())
                    const key = `${today.getDate()}/${today.getMonth() + 1}/${today.getFullYear()}`

                    var currentDay = this.days.find(t => t.title === key)

                    if (currentDay === undefined) {
                        const content = {
                            title: key,
                            items: []
                        }

                        this.days.push(content)
                    }

                    const index = this.days.findIndex(t => t.title == key)

                    if (index == -1) {
                        throw "Index out of bound."
                    }

                    const day = this.days[index]

                    const item = {
                        description: this.inputValue,
                        complete: false
                    }

                    day.items.push(item)

                    this.inputValue = ""

                    this.saveCurrentDays()
                },
                saveCurrentDays() {
                    localStorage.days = JSON.stringify(this.days)
                }
            }
        }

        createApp(appConfig).mount('#app')
    </script>
</body>

</html>